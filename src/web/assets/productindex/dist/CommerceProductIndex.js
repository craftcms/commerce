Craft.Commerce.ProductIndex=Craft.BaseElementIndex.extend({editableProductTypes:null,$newProductBtnProductType:null,$newProductBtn:null,init:function(t,e,r){this.on("selectSource",$.proxy(this,"updateButton")),this.on("selectSite",$.proxy(this,"updateButton")),this.base(t,e,r)},afterInit:function(){this.editableProductTypes=[];for(var t=0;t<Craft.Commerce.editableProductTypes.length;t++){var e=Craft.Commerce.editableProductTypes[t];this.getSourceByKey("productType:"+e.id)&&this.editableProductTypes.push(e)}this.base()},getDefaultSourceKey:function(){if("index"===this.settings.context&&"undefined"!=typeof defaultProductTypeHandle)for(var t=0;t<this.$sources.length;t++){var e=$(this.$sources[t]);if(e.data("handle")===defaultProductTypeHandle)return e.data("key")}return this.base()},updateButton:function(){if(this.$source){var t,e,r,i=this.$source.data("handle");if(this.editableProductTypes.length){var n,d;if(this.$newProductBtnProductType&&this.$newProductBtnProductType.remove(),i)for(t=0;t<this.editableProductTypes.length;t++)if(this.editableProductTypes[t].handle===i){n=this.editableProductTypes[t];break}if(this.$newProductBtnProductType=$('<div class="btngroup submit"/>'),n?(e=this._getProductTypeTriggerHref(n),r="index"===this.settings.context?Craft.t("commerce","New product"):Craft.t("commerce","New {productType} product",{productType:n.name}),this.$newProductBtn=$('<a class="btn submit add icon" '+e+">"+Craft.escapeHtml(r)+"</a>").appendTo(this.$newProductBtnProductType),"index"!==this.settings.context&&this.addListener(this.$newProductBtn,"click",(function(t){this._openCreateProductModal(t.currentTarget.getAttribute("data-id"))})),this.editableProductTypes.length>1&&(d=$('<div class="btn submit menubtn"></div>').appendTo(this.$newProductBtnProductType))):this.$newProductBtn=d=$('<div class="btn submit add icon menubtn">'+Craft.t("commerce","New product")+"</div>").appendTo(this.$newProductBtnProductType),d){var o='<div class="menu"><ul>';for(t=0;t<this.editableProductTypes.length;t++){var s=this.editableProductTypes[t];"index"!==this.settings.context&&s===n||(e=this._getProductTypeTriggerHref(s),r="index"===this.settings.context?s.name:Craft.t("commerce","New {productType} product",{productType:s.name}),o+="<li><a "+e+'">'+Craft.escapeHtml(r)+"</a></li>")}o+="</ul></div>",$(o).appendTo(this.$newProductBtnProductType);var c=new Garnish.MenuBtn(d);"index"!==this.settings.context&&c.on("optionSelect",$.proxy((function(t){this._openCreateProductModal(t.option.getAttribute("data-id"))}),this))}this.addButton(this.$newProductBtnProductType)}if("index"===this.settings.context&&"undefined"!=typeof history){var a="commerce/products";i&&(a+="/"+i),history.replaceState({},"",Craft.getUrl(a))}}},_getProductTypeTriggerHref:function(t){if("index"===this.settings.context){var e="commerce/products/"+t.handle+"/new";if(this.siteId&&this.siteId!=Craft.primarySiteId)for(var r=0;r<Craft.sites.length;r++)Craft.sites[r].id==this.siteId&&(e+="/"+Craft.sites[r].handle);return'href="'+Craft.getUrl(e)+'"'}return'data-id="'+t.id+'"'},_openCreateProductModal:function(t){if(!this.$newProductBtn.hasClass("loading")){for(var e,r=0;r<this.editableProductTypes.length;r++)if(this.editableProductTypes[r].id==t){e=this.editableProductTypes[r];break}if(e){this.$newProductBtn.addClass("inactive");var i=this.$newProductBtn.text();this.$newProductBtn.text(Craft.t("commerce","New {productType} product",{productType:e.name})),Craft.createElementEditor(this.elementType,{hudTrigger:this.$newProductBtnProductType,elementType:"craft\\elements\\Product",siteId:this.siteId,attributes:{productTypeId:t},onBeginLoading:$.proxy((function(){this.$newProductBtn.addClass("loading")}),this),onEndLoading:$.proxy((function(){this.$newProductBtn.removeClass("loading")}),this),onHideHud:$.proxy((function(){this.$newProductBtn.removeClass("inactive").text(i)}),this),onSaveElement:$.proxy((function(e){var r="productType:"+t;this.sourceKey!==r&&this.selectSourceByKey(r),this.selectElementAfterUpdate(e.id),this.updateElements()}),this)})}}}}),Craft.registerElementIndexClass("craft\\commerce\\elements\\Product",Craft.Commerce.ProductIndex);
//# sourceMappingURL=CommerceProductIndex.js.map