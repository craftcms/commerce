{"version":3,"file":"VariantMatrix.js","mappings":"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","sources":["webpack:///./VariantMatrix.js"],"sourcesContent":["(function ($) {\n  if (typeof Craft.Commerce === typeof undefined) {\n    Craft.Commerce = {};\n  }\n\n  /**\n   * Variant Matrix class\n   */\n  Craft.Commerce.VariantMatrix = Garnish.Base.extend(\n    {\n      id: null,\n      fieldBodyHtml: null,\n      fieldFootHtml: null,\n      inputNamePrefix: null,\n      inputIdPrefix: null,\n\n      $container: null,\n      $variantContainer: null,\n      $addVariantBtn: null,\n\n      variantSort: null,\n      variantSelect: null,\n      defaultVariant: null,\n      totalNewVariants: 0,\n      singleColumnMode: false,\n\n      init: function (id, fieldBodyHtml, fieldFootHtml, inputNamePrefix) {\n        this.id = id;\n        this.fieldBodyHtml = fieldBodyHtml;\n        this.fieldFootHtml = fieldFootHtml;\n        this.inputNamePrefix = inputNamePrefix;\n        this.inputIdPrefix = Craft.formatInputId(this.inputNamePrefix);\n\n        this.$container = $('#' + this.id);\n        this.$variantContainer = this.$container.children('.blocks');\n        this.$addVariantBtn = this.$container.children('.btn');\n\n        var $variants = this.$variantContainer.children();\n        var collapsedVariants =\n          Craft.Commerce.VariantMatrix.getCollapsedVariantIds();\n\n        this.variantSort = new Garnish.DragSort($variants, {\n          handle: '> .actions > .move',\n          axis: 'y',\n          filter: $.proxy(function () {\n            // Only return all the selected items if the target item is selected\n            if (this.variantSort.$targetItem.hasClass('sel')) {\n              return this.variantSelect.getSelectedItems();\n            } else {\n              return this.variantSort.$targetItem;\n            }\n          }, this),\n          collapseDraggees: true,\n          magnetStrength: 4,\n          helperLagBase: 1.5,\n          helperOpacity: 0.9,\n          onSortChange: $.proxy(function () {\n            this.variantSelect.resetItemOrder();\n          }, this),\n        });\n\n        this.variantSelect = new Garnish.Select(\n          this.$variantContainer,\n          $variants,\n          {\n            multi: true,\n            vertical: true,\n            handle: '> .checkbox, > .titlebar',\n            checkboxMode: true,\n          }\n        );\n\n        for (var i = 0; i < $variants.length; i++) {\n          var $variant = $variants.eq(i),\n            id = $variant.data('id');\n\n          // Is this a new variant?\n          var newMatch = typeof id === 'string' && id.match(/new(\\d+)/);\n\n          if (newMatch && newMatch[1] > this.totalNewVariants) {\n            this.totalNewVariants = parseInt(newMatch[1]);\n          }\n\n          var variant = new Variant(this, $variant);\n\n          if (\n            variant.id &&\n            $.inArray('' + variant.id, collapsedVariants) !== -1\n          ) {\n            variant.collapse();\n          }\n\n          // Init the unlimited stock checkbox\n          Craft.Commerce.initUnlimitedStockCheckbox($variant);\n        }\n\n        this.addListener(this.$addVariantBtn, 'click', function () {\n          this.addVariant();\n        });\n\n        this.addListener(this.$container, 'resize', 'handleContainerResize');\n        Garnish.$doc.ready($.proxy(this, 'handleContainerResize'));\n\n        if (this.$container.width()) {\n          this.handleContainerResize();\n        }\n      },\n\n      setDefaultVariant: function (variant) {\n        if (this.defaultVariant) {\n          this.defaultVariant.unsetAsDefault();\n        }\n\n        variant.setAsDefault();\n        this.defaultVariant = variant;\n      },\n\n      addVariant: function ($insertBefore) {\n        this.totalNewVariants++;\n\n        var id = 'new' + this.totalNewVariants;\n\n        // TODO: Refactor into more acceptable code for prettier\n        // prettier-ignore\n        var $variant = $(\n                    '<div class=\"variant-matrixblock matrixblock\" data-id=\"' + id + '\">' +\n                    '<input type=\"hidden\" name=\"' + this.inputNamePrefix + '[' + id + '][enabled]\" value=\"1\"/>' +\n                    '<input class=\"default-input\" type=\"hidden\" name=\"' + this.inputNamePrefix + '[' + id + '][isDefault]\" value=\"\">' +\n                    '<div class=\"titlebar\">' +\n                    '<div class=\"preview\"></div>' +\n                    '</div>' +\n                    '<div class=\"checkbox\" title=\"' + Craft.t('commerce', 'Select') + '\"></div>' +\n                    '<div class=\"actions\">' +\n                    '<div class=\"status off\" title=\"' + Craft.t('commerce', 'Disabled') + '\"></div>' +\n                    '<a class=\"default-btn\" title=\"' + Craft.t('commerce', 'Set as the default variant') + '\">' + Craft.t('commerce', 'Default') + '</a> ' +\n                    '<a class=\"settings icon menubtn\" title=\"' + Craft.t('commerce', 'Actions') + '\" role=\"button\"></a> ' +\n                    '<div class=\"menu\">' +\n                    '<ul class=\"padded\">' +\n                    '<li><a data-icon=\"collapse\" data-action=\"collapse\">' + Craft.t('commerce', 'Collapse') + '</a></li>' +\n                    '<li class=\"hidden\"><a data-icon=\"expand\" data-action=\"expand\">' + Craft.t('commerce', 'Expand') + '</a></li>' +\n                    '<li><a data-icon=\"disabled\" data-action=\"disable\">' + Craft.t('commerce', 'Disable') + '</a></li>' +\n                    '<li class=\"hidden\"><a data-icon=\"enabled\" data-action=\"enable\">' + Craft.t('commerce', 'Enable') + '</a></li>' +\n                    '</ul>' +\n                    '<hr class=\"padded\"/>' +\n                    '<ul class=\"padded\">' +\n                    '<li><a data-icon=\"+\" data-action=\"add\">' + Craft.t('commerce', 'Add variant above') + '</a></li>' +\n                    '</ul>' +\n                    '<hr class=\"padded\"/>' +\n                    '<ul class=\"padded\">' +\n                    '<li><a data-icon=\"remove\" data-action=\"delete\">' + Craft.t('commerce', 'Delete') + '</a></li>' +\n                    '</ul>' +\n                    '</div>' +\n                    '<a class=\"move icon\" title=\"' + Craft.t('commerce', 'Reorder') + '\" role=\"button\"></a> ' +\n                    '</div>' +\n                    '</div>'\n                );\n\n        if ($insertBefore) {\n          $variant.insertBefore($insertBefore);\n        } else {\n          $variant.appendTo(this.$variantContainer);\n        }\n\n        var $fieldsContainer = $('<div class=\"fields\"/>').appendTo($variant),\n          bodyHtml = this.getParsedVariantHtml(this.fieldBodyHtml, id),\n          footHtml = this.getParsedVariantHtml(this.fieldFootHtml, id);\n\n        var $body = $(bodyHtml);\n        $body.find('#related-sales-field').remove();\n\n        $body.appendTo($fieldsContainer);\n\n        if (this.singleColumnMode) {\n          this.setVariantsToSingleColMode($variant);\n        }\n\n        // Animate the variant into position\n        $variant.css(this.getHiddenVariantCss($variant)).velocity(\n          {\n            opacity: 1,\n            'margin-bottom': 10,\n          },\n          'fast',\n          $.proxy(function () {\n            $variant.css('margin-bottom', '');\n            Garnish.$bod.append(footHtml);\n            Craft.initUiElements($fieldsContainer);\n            Craft.Commerce.initUnlimitedStockCheckbox($variant);\n            var variant = new Variant(this, $variant);\n            this.variantSort.addItems($variant);\n            this.variantSelect.addItems($variant);\n\n            Garnish.requestAnimationFrame(function () {\n              // Scroll to the variant\n              Garnish.scrollContainerToElement($variant);\n            });\n\n            // If this is the only variant, set it as the default\n            if (this.$variantContainer.children().length === 1) {\n              this.setDefaultVariant(variant);\n            }\n          }, this)\n        );\n      },\n\n      collapseSelectedVariants: function () {\n        this.callOnSelectedVariants('collapse');\n      },\n\n      expandSelectedVariants: function () {\n        this.callOnSelectedVariants('expand');\n      },\n\n      disableSelectedVariants: function () {\n        this.callOnSelectedVariants('disable');\n      },\n\n      enableSelectedVariants: function () {\n        this.callOnSelectedVariants('enable');\n      },\n\n      deleteSelectedVariants: function () {\n        this.callOnSelectedVariants('selfDestruct');\n      },\n\n      callOnSelectedVariants: function (fn) {\n        for (var i = 0; i < this.variantSelect.$selectedItems.length; i++) {\n          this.variantSelect.$selectedItems.eq(i).data('variant')[fn]();\n        }\n      },\n\n      getHiddenVariantCss: function ($variant) {\n        return {\n          opacity: 0,\n          marginBottom: -$variant.outerHeight(),\n        };\n      },\n\n      getParsedVariantHtml: function (html, id) {\n        if (typeof html === 'string') {\n          return html.replace(/__VARIANT__/g, id);\n        } else {\n          return '';\n        }\n      },\n\n      handleContainerResize: function () {\n        if (this.$container.width() < 700) {\n          if (!this.singleColumnMode) {\n            this.setVariantsToSingleColMode(this.variantSort.$items);\n            this.singleColumnMode = true;\n          }\n        } else {\n          if (this.singleColumnMode) {\n            this.setVariantsToTwoColMode(this.variantSort.$items);\n            this.variantSort.$items.removeClass('single-col');\n            this.singleColumnMode = false;\n          }\n        }\n      },\n\n      setVariantsToSingleColMode: function ($variants) {\n        $variants\n          .addClass('single-col')\n          .find('> .fields > .custom-fields')\n          .addClass('meta');\n      },\n\n      setVariantsToTwoColMode: function ($variants) {\n        $variants\n          .removeClass('single-col')\n          .find('> .fields > .custom-fields')\n          .removeClass('meta');\n      },\n    },\n    {\n      collapsedVariantStorageKey:\n        'Craft-' + Craft.siteUid + '.Commerce.VariantMatrix.collapsedVariants',\n\n      getCollapsedVariantIds: function () {\n        if (\n          typeof localStorage[\n            Craft.Commerce.VariantMatrix.collapsedVariantStorageKey\n          ] === 'string'\n        ) {\n          return Craft.filterArray(\n            localStorage[\n              Craft.Commerce.VariantMatrix.collapsedVariantStorageKey\n            ].split(',')\n          );\n        } else {\n          return [];\n        }\n      },\n\n      setCollapsedVariantIds: function (ids) {\n        localStorage[Craft.Commerce.VariantMatrix.collapsedVariantStorageKey] =\n          ids.join(',');\n      },\n\n      rememberCollapsedVariantId: function (id) {\n        if (typeof Storage !== 'undefined') {\n          var collapsedVariants =\n            Craft.Commerce.VariantMatrix.getCollapsedVariantIds();\n\n          if ($.inArray('' + id, collapsedVariants) === -1) {\n            collapsedVariants.push(id);\n            Craft.Commerce.VariantMatrix.setCollapsedVariantIds(\n              collapsedVariants\n            );\n          }\n        }\n      },\n\n      forgetCollapsedVariantId: function (id) {\n        if (typeof Storage !== 'undefined') {\n          var collapsedVariants =\n              Craft.Commerce.VariantMatrix.getCollapsedVariantIds(),\n            collapsedVariantsIndex = $.inArray('' + id, collapsedVariants);\n\n          if (collapsedVariantsIndex !== -1) {\n            collapsedVariants.splice(collapsedVariantsIndex, 1);\n            Craft.Commerce.VariantMatrix.setCollapsedVariantIds(\n              collapsedVariants\n            );\n          }\n        }\n      },\n    }\n  );\n\n  var Variant = Garnish.Base.extend({\n    matrix: null,\n    $container: null,\n    $titlebar: null,\n    $fieldsContainer: null,\n    $previewContainer: null,\n    $actionMenu: null,\n    $collapsedInput: null,\n    $defaultInput: null,\n    $defaultBtn: null,\n\n    isNew: null,\n    id: null,\n\n    collapsed: false,\n\n    init: function (matrix, $container) {\n      this.matrix = matrix;\n      this.$container = $container;\n      this.$titlebar = $container.children('.titlebar');\n      this.$previewContainer = this.$titlebar.children('.preview');\n      this.$fieldsContainer = $container.children('.fields');\n      this.$defaultInput = this.$container.children('.default-input');\n      this.$defaultBtn = this.$container.find('> .actions > .default-btn');\n\n      this.$container.data('variant', this);\n\n      this.id = this.$container.data('id');\n      this.isNew =\n        !this.id ||\n        (typeof this.id === 'string' && this.id.substr(0, 3) === 'new');\n\n      var $menuBtn = this.$container.find('> .actions > .settings'),\n        menuBtn = new Garnish.MenuBtn($menuBtn);\n\n      this.$actionMenu = menuBtn.menu.$container;\n\n      menuBtn.menu.settings.onOptionSelect = $.proxy(\n        this,\n        'onMenuOptionSelect'\n      );\n\n      // Was this variant already collapsed?\n      if (Garnish.hasAttr(this.$container, 'data-collapsed')) {\n        this.collapse();\n      }\n\n      this.addListener(this.$titlebar, 'dblclick', function (ev) {\n        ev.preventDefault();\n        this.toggle();\n      });\n\n      // Is this variant the default?\n      if (this.$defaultInput.val() === '1') {\n        this.matrix.setDefaultVariant(this);\n      }\n\n      this.addListener(this.$defaultBtn, 'click', function (ev) {\n        ev.preventDefault();\n        this.matrix.setDefaultVariant(this);\n      });\n    },\n\n    toggle: function () {\n      if (this.collapsed) {\n        this.expand();\n      } else {\n        this.collapse(true);\n      }\n    },\n\n    collapse: function (animate) {\n      if (this.collapsed) {\n        return;\n      }\n\n      this.$container.addClass('collapsed');\n\n      var previewHtml = '',\n        $fields = this.$fieldsContainer.find(\n          '> .meta > .field:first-child, > .custom-fields .field'\n        );\n\n      for (var i = 0; i < $fields.length; i++) {\n        var $field = $($fields[i]),\n          $inputs = $field\n            .children('.input')\n            .find('select,input[type!=\"hidden\"],textarea,.label'),\n          inputPreviewText = '';\n\n        for (var j = 0; j < $inputs.length; j++) {\n          var $input = $($inputs[j]),\n            value;\n\n          if ($input.hasClass('label')) {\n            var $maybeLightswitchContainer = $input.parent().parent();\n\n            if (\n              $maybeLightswitchContainer.hasClass('lightswitch') &&\n              (($maybeLightswitchContainer.hasClass('on') &&\n                $input.hasClass('off')) ||\n                (!$maybeLightswitchContainer.hasClass('on') &&\n                  $input.hasClass('on')))\n            ) {\n              continue;\n            }\n\n            value = $input.text();\n          } else {\n            value = Craft.getText(Garnish.getInputPostVal($input));\n          }\n\n          if (value instanceof Array) {\n            value = value.join(', ');\n          }\n\n          if (value) {\n            value = Craft.trim(value);\n\n            if (value) {\n              if (inputPreviewText) {\n                inputPreviewText += ', ';\n              }\n\n              inputPreviewText += value;\n            }\n          }\n        }\n\n        if (inputPreviewText) {\n          previewHtml +=\n            (previewHtml ? ' <span>|</span> ' : '') + inputPreviewText;\n        }\n      }\n\n      this.$previewContainer.html(previewHtml);\n\n      this.$fieldsContainer.velocity('stop');\n      this.$container.velocity('stop');\n\n      if (animate) {\n        this.$fieldsContainer.velocity('fadeOut', {duration: 'fast'});\n        this.$container.velocity({height: 30}, 'fast');\n      } else {\n        this.$previewContainer.show();\n        this.$fieldsContainer.hide();\n        this.$container.css({height: 30});\n      }\n\n      setTimeout(\n        $.proxy(function () {\n          this.$actionMenu\n            .find('a[data-action=collapse]:first')\n            .parent()\n            .addClass('hidden');\n          this.$actionMenu\n            .find('a[data-action=expand]:first')\n            .parent()\n            .removeClass('hidden');\n        }, this),\n        200\n      );\n\n      // Remember that?\n      if (!this.isNew) {\n        Craft.Commerce.VariantMatrix.rememberCollapsedVariantId(this.id);\n      } else {\n        if (!this.$collapsedInput) {\n          this.$collapsedInput = $(\n            '<input type=\"hidden\" name=\"' +\n              this.matrix.inputNamePrefix +\n              '[' +\n              this.id +\n              '][collapsed]\" value=\"1\"/>'\n          ).appendTo(this.$container);\n        } else {\n          this.$collapsedInput.val('1');\n        }\n      }\n\n      this.collapsed = true;\n    },\n\n    expand: function () {\n      if (!this.collapsed) {\n        return;\n      }\n\n      this.$container.removeClass('collapsed');\n\n      this.$fieldsContainer.velocity('stop');\n      this.$container.velocity('stop');\n\n      var collapsedContainerHeight = this.$container.height();\n      this.$container.height('auto');\n      this.$fieldsContainer.css('display', 'flex');\n      var expandedContainerHeight = this.$container.height();\n      this.$container.height(collapsedContainerHeight);\n      this.$fieldsContainer\n        .hide()\n        .velocity('fadeIn', {duration: 'fast', display: 'flex'});\n      this.$container.velocity(\n        {height: expandedContainerHeight},\n        'fast',\n        $.proxy(function () {\n          this.$previewContainer.html('');\n          this.$container.height('auto');\n        }, this)\n      );\n\n      setTimeout(\n        $.proxy(function () {\n          this.$actionMenu\n            .find('a[data-action=collapse]:first')\n            .parent()\n            .removeClass('hidden');\n          this.$actionMenu\n            .find('a[data-action=expand]:first')\n            .parent()\n            .addClass('hidden');\n        }, this),\n        200\n      );\n\n      // Remember that?\n      if (!this.isNew && typeof Storage !== 'undefined') {\n        var collapsedVariants =\n            Craft.Commerce.VariantMatrix.getCollapsedVariantIds(),\n          collapsedVariantsIndex = $.inArray('' + this.id, collapsedVariants);\n\n        if (collapsedVariantsIndex !== -1) {\n          collapsedVariants.splice(collapsedVariantsIndex, 1);\n          Craft.Commerce.VariantMatrix.setCollapsedVariantIds(\n            collapsedVariants\n          );\n        }\n      }\n\n      if (!this.isNew) {\n        Craft.Commerce.VariantMatrix.forgetCollapsedVariantId(this.id);\n      } else if (this.$collapsedInput) {\n        this.$collapsedInput.val('');\n      }\n\n      this.collapsed = false;\n    },\n\n    disable: function () {\n      // TODO revisit in 5.0 with mult-store support\n      // if (this.isDefault()) {\n      //     // Can't disable the default variant\n      //     return false;\n      // }\n\n      this.$container.children('input[name$=\"[enabled]\"]:first').val('');\n      this.$container.addClass('disabled-entry');\n\n      setTimeout(\n        $.proxy(function () {\n          this.$actionMenu\n            .find('a[data-action=disable]:first')\n            .parent()\n            .addClass('hidden');\n          this.$actionMenu\n            .find('a[data-action=enable]:first')\n            .parent()\n            .removeClass('hidden');\n        }, this),\n        200\n      );\n\n      this.collapse(true);\n\n      return true;\n    },\n\n    enable: function () {\n      this.$container.children('input[name$=\"[enabled]\"]:first').val('1');\n      this.$container.removeClass('disabled-entry');\n\n      setTimeout(\n        $.proxy(function () {\n          this.$actionMenu\n            .find('a[data-action=disable]:first')\n            .parent()\n            .removeClass('hidden');\n          this.$actionMenu\n            .find('a[data-action=enable]:first')\n            .parent()\n            .addClass('hidden');\n        }, this),\n        200\n      );\n\n      return true;\n    },\n\n    setAsDefault: function () {\n      this.$defaultInput.val('1');\n      this.$defaultBtn.addClass('sel').attr('title', '');\n\n      // Default variants must be enabled\n      // TODO revisit in 5.0 with mult-store support\n      // this.enable();\n      // this.$actionMenu.find('a[data-action=disable]:first').parent().addClass('disabled');\n    },\n\n    unsetAsDefault: function () {\n      this.$defaultInput.val('');\n      this.$defaultBtn\n        .removeClass('sel')\n        .attr('title', 'Set as the default variant');\n\n      this.$actionMenu\n        .find('a[data-action=disable]:first')\n        .parent()\n        .removeClass('disabled-entry');\n    },\n\n    isDefault: function () {\n      return this.$defaultInput.val() === '1';\n    },\n\n    onMenuOptionSelect: function (option) {\n      var batchAction =\n          this.matrix.variantSelect.totalSelected > 1 &&\n          this.matrix.variantSelect.isSelected(this.$container),\n        $option = $(option);\n\n      switch ($option.data('action')) {\n        case 'collapse': {\n          if (batchAction) {\n            this.matrix.collapseSelectedVariants();\n          } else {\n            this.collapse(true);\n          }\n\n          break;\n        }\n\n        case 'expand': {\n          if (batchAction) {\n            this.matrix.expandSelectedVariants();\n          } else {\n            this.expand();\n          }\n\n          break;\n        }\n\n        case 'disable': {\n          if (batchAction) {\n            this.matrix.disableSelectedVariants();\n          } else {\n            this.disable();\n          }\n\n          break;\n        }\n\n        case 'enable': {\n          if (batchAction) {\n            this.matrix.enableSelectedVariants();\n          } else {\n            this.enable();\n            this.expand();\n          }\n\n          break;\n        }\n\n        case 'add': {\n          this.matrix.addVariant(this.$container);\n          break;\n        }\n\n        case 'delete': {\n          if (batchAction) {\n            if (\n              confirm(\n                Craft.t(\n                  'commerce',\n                  'Are you sure you want to delete the selected variants?'\n                )\n              )\n            ) {\n              this.matrix.deleteSelectedVariants();\n            }\n          } else {\n            this.selfDestruct();\n          }\n\n          break;\n        }\n      }\n    },\n\n    selfDestruct: function () {\n      this.$container.velocity(\n        this.matrix.getHiddenVariantCss(this.$container),\n        'fast',\n        $.proxy(function () {\n          this.$container.remove();\n\n          // If this is the default variant, set the first variant as default instead\n          if (this.isDefault()) {\n            var variant = this.matrix.$variantContainer\n              .children(':first-child')\n              .data('variant');\n\n            if (variant) {\n              this.matrix.setDefaultVariant(variant);\n            }\n          }\n        }, this)\n      );\n    },\n  });\n})(jQuery);\n"],"names":["$","Craft","Commerce","VariantMatrix","Garnish","Base","extend","id","fieldBodyHtml","fieldFootHtml","inputNamePrefix","inputIdPrefix","$container","$variantContainer","$addVariantBtn","variantSort","variantSelect","defaultVariant","totalNewVariants","singleColumnMode","init","this","formatInputId","children","$variants","collapsedVariants","getCollapsedVariantIds","DragSort","handle","axis","filter","proxy","$targetItem","hasClass","getSelectedItems","collapseDraggees","magnetStrength","helperLagBase","helperOpacity","onSortChange","resetItemOrder","Select","multi","vertical","checkboxMode","i","length","$variant","eq","newMatch","data","match","parseInt","variant","Variant","inArray","collapse","initUnlimitedStockCheckbox","addListener","addVariant","$doc","ready","width","handleContainerResize","setDefaultVariant","unsetAsDefault","setAsDefault","$insertBefore","t","insertBefore","appendTo","$fieldsContainer","bodyHtml","getParsedVariantHtml","footHtml","$body","find","remove","setVariantsToSingleColMode","css","getHiddenVariantCss","velocity","opacity","$bod","append","initUiElements","addItems","requestAnimationFrame","scrollContainerToElement","collapseSelectedVariants","callOnSelectedVariants","expandSelectedVariants","disableSelectedVariants","enableSelectedVariants","deleteSelectedVariants","fn","$selectedItems","marginBottom","outerHeight","html","replace","$items","setVariantsToTwoColMode","removeClass","addClass","collapsedVariantStorageKey","siteUid","localStorage","filterArray","split","setCollapsedVariantIds","ids","join","rememberCollapsedVariantId","Storage","push","forgetCollapsedVariantId","collapsedVariantsIndex","splice","matrix","$titlebar","$previewContainer","$actionMenu","$collapsedInput","$defaultInput","$defaultBtn","isNew","collapsed","substr","$menuBtn","menuBtn","MenuBtn","menu","settings","onOptionSelect","hasAttr","ev","preventDefault","toggle","val","expand","animate","previewHtml","$fields","$inputs","inputPreviewText","j","value","$input","$maybeLightswitchContainer","parent","text","getText","getInputPostVal","Array","trim","duration","height","show","hide","setTimeout","collapsedContainerHeight","expandedContainerHeight","display","disable","enable","attr","isDefault","onMenuOptionSelect","option","batchAction","totalSelected","isSelected","confirm","selfDestruct","jQuery"],"sourceRoot":""}